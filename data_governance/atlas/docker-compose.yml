version: '3'

services:
  # Apache Atlas requires Solr and Zookeeper/Kafka (embedded in the all-in-one image usually, but here is a split setup)
  
  zookeeper:
    image: zookeeper:3.5
    container_name: atlas_zookeeper
    networks:
      - atlas_network
  
  kafka:
    image: confluentinc/cp-kafka:5.5.1
    container_name: atlas_kafka
    depends_on:
      - zookeeper
    environment:
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
    networks:
      - atlas_network

  # Using a pre-built Atlas image (community maintained is best as official is source-only)
  atlas:
    image: sburn/apache-atlas:2.3.0
    container_name: apache_atlas
    depends_on:
      - zookeeper
      - kafka
    ports:
      - "21000:21000"
    environment:
      - MANAGE_LOCAL_SOLR=true
      - MANAGE_LOCAL_HBASE=true
    networks:
      - atlas_network
    volumes:
      - atlas_data:/opt/apache/atlas/data

networks:
  atlas_network:
    driver: bridge

volumes:
  atlas_data:
